---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const formatDate = (value: string) =>
	new Date(value).toLocaleDateString(undefined, {
		year: 'numeric',
		month: 'short',
		day: 'numeric',
	});
---

<Layout title="Blog | C4bbage64" description="Writing, notes, and project updates">
	<section class="mx-auto max-w-6xl px-6 py-14 lg:py-20">
		<div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
			<div>
				<p class="text-sm uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400">Blog</p>
				<h1 class="text-3xl font-semibold leading-tight sm:text-4xl">Writing & Notes</h1>
				<p class="mt-3 max-w-2xl text-slate-600 dark:text-slate-300">
					Swap these entries with your own posts. Each card shows a title, summary, date, tags, and reading time.
				</p>
			</div>
			<a class="btn-secondary" href="mailto:m.irfandeni@gmail.com">Request a topic</a>
		</div>

		<div class="mt-10 grid gap-5 md:grid-cols-2">
			{posts.map((post) => (
				<article class="card group flex h-full flex-col gap-3 p-5 transition hover:-translate-y-1 hover:shadow-xl">
					<div class="flex items-center gap-3 text-xs font-semibold uppercase tracking-[0.12em] text-slate-500 dark:text-slate-400">
						<span>{formatDate(post.data.date)}</span>
						<span class="h-px w-6 bg-slate-200 dark:bg-slate-700"></span>
						{post.data.readingTime && <span>{post.data.readingTime}</span>}
					</div>
					<h2 class="text-xl font-semibold group-hover:text-slate-900 dark:group-hover:text-white">{post.data.title}</h2>
					<p class="text-sm text-slate-600 dark:text-slate-300">{post.data.description}</p>
					<div class="flex flex-wrap gap-2 pt-1">
						{post.data.tags?.map((tag) => (
							<span class="pill text-xs">{tag}</span>
						))}
					</div>
					<div class="mt-auto pt-2">
						<a class="btn-ghost" href={`/blog/${post.slug}/`}>Read</a>
					</div>
				</article>
			))}
		</div>

		<div class="mt-12 rounded-2xl border border-dashed border-slate-300/70 bg-white/70 p-6 text-sm text-slate-700 shadow-sm backdrop-blur dark:border-slate-700/70 dark:bg-slate-900/60 dark:text-slate-200">
			<p class="font-semibold">How to add posts</p>
			<ol class="mt-2 list-decimal space-y-2 pl-5">
				<li>Add a Markdown file to <code>src/content/blog</code> with the frontmatter fields you need (title, description, date, tags, readingTime).</li>
				<li>Save the file with a descriptive name; Astro uses it for the slug (e.g., <code>my-post.md</code> → <code>/blog/my-post</code>).</li>
				<li>Run <code>npm run dev</code> locally to preview and push to <code>main</code> when ready—GitHub Pages rebuilds automatically.</li>
			</ol>
		</div>
	</section>
</Layout>
